# Модульные тесты

## card_holder

    * Если card_holder содержит более одного пробела, то тестируемый метод возвращает 400 с сообщением об ошибке;
    * Если card_holder содержит символы которые не являющиеся латиницей, пробелом или дефисом, то тестируемый метод возвращает 400 с сообщением об ошибке;
    * Если card_holder содержит менее или более двух слов, то тестируемый метод возвращает 400 с сообщением об ошибке;
    * Если card_holder содержит дефис справа или слева ограничен пробелом (те не разделяет одно слово на составные), то тестируемый метод возвращает 400 с сообщением об ошибке;
    * (не точно, завит от условий. Возможно есть трех- и более - составные имена) Если card_holder содержит дефис делит слово более, чем на две части, то тестируемый метод возвращает 400 с сообщением об ошибке;
    * Если card_holder содержит слишком много символов, то тестируемый метод возвращает 400 с сообщением об ошибке; 
    
## card_number

    * Если поле содержит симфолы не цифры, то тестируемый метод возвращает 400 с сообщением об ошибке;
    * Если поле состоит не из 16 символов, то тестируемый метод возвращает 400 с сообщением об ошибке;
    
## card_expiration

    * Если поле не соответсвует [^\d{2}\/\d{2}$], то тестируемый метод возвращает 400 с сообщением об ошибке;
    * Если месяц сожержит число не в диапазоне 1-12, то тестируемый метод возвращает 400 с сообщением об ошибке;
    * Если год меньше текущего, то тестируемый метод возвращает 400 с сообщением об ошибке;
    * Если год текущий, а месяц меньше текущего, то тестируемый метод возвращает 400 с сообщением об ошибке;
    
## cvv

    * Если поле не соответствует [^\d{3}$], то тестируемый метод возвращает 400 с сообщением об ошибке;

## order_number

    * Если order_number содержит меньше 1 символа, то тестируемый метод возвращает 400 с сообщением об ошибке;
    * Если order_number содержит больше 16 символов, то тестируемый метод возвращает 400 с сообщением об ошибке;
    
## sum

    * Если не соответветвует численному значению - [^\d+,\d+$], то тестируемый метод возвращает 400 с сообщением об ошибке;

*Успешно* если не возникло ошибок при валидации каждого поля, то не возвращается код 400

## тесты setOrderIsPaid(string $orderNumber, float $sum): bool

    * если методу передан пустой аргумент $orderNumber, выбрасывается исключение OrderArgumentException;
    * если методу передан аргумент $orderNumber не строка, выбрасывается исключение OrderArgumentException;
    * если методу передан пустой аргумент $sum, выбрасывается исключение OrderArgumentException;
    * если методу передан аргумент $sum не вещественное число, выбрасывается исключение OrderArgumentException;
    * если метод вернул не булевое значение, выбрасывается исключение OrderException;
    * если метод вернул false, выбрасывается исключение OrderException;

*Успешно* метод вернет true
    
# Интеграционные тесты

## проверяем связку «фронт-бэк»:

    * Если отправлены невалидные данные card_holder, то после получения ответа от бэка на фронте выделяется поле «владелец карты» красной рамкой и под полем выводит сообщение об ошибке;
    * Если отправлены невалидные данные card_number, то после получения ответа от бэка на фронте выделяется поле «Номер карты» красной рамкой и под полем выводит сообщение об ошибке;
    * Если отправлены невалидные данные card_expiration, то после получения ответа от бэка на фронте выделяется поле «Месяц/год окончания действия карты» красной рамкой и под полем выводит сообщение об ошибке;
    * Если отправлены невалидные данные cvv, то после получения ответа от бэка на фронте выделяется поле «CVV код» красной рамкой и под полем выводит сообщение об ошибке;
    * Если отправлены невалидные данные order_number, то после получения ответа от бэка на фронте выделяется поле «Номер заказа» красной рамкой и под полем выводит сообщение об ошибке;
    * Если отправлены невалидные данные sum, то после получения ответа от бэка на фронте выделяется поле «Сумма оплаты» красной рамкой и под полем выводит сообщение об ошибке;
    * При нажатии кнопки "Оплатить" даные отправляются и бэк соответственно отвечает

## проверяем связку  «бэк-сервис А»:

    * Бэк отправляет запрос на сервис А, сервису А не удалось списать деньги и сервис А отправляет ответ с кодом 403;
    * Бэк отправляет запрос на сервис А, сервису А удалось списать деньги и сервис А отправляет ответ с кодом 200;

## проверяем связку «бэк-репозиторий»:

    * Бэк запускает метод репозитория setOrderIsPaid с невалидным значением аргумента $orderNumber, выбросывается исключение OrderArgumentException;
    * Бэк запускает метод репозитория setOrderIsPaid с невалидным значением аргумента $sum, выбросывается исключение OrderArgumentException;
    * Бэк запускает метод репозитория setOrderIsPaid с валидными значениеми аргументов, репозиторий возвращает true;

# Системные тесты
    * фронт отправляет невалидное поле на бэк, бэк возвращает ответ 400, фронт подсвечивает поле красным и выводит соответствующее сообщение
    * фронт отправляет валидный запрос на бэк, бэк отправляет запрост сервису А, сервис А не производит оплату возвращает ответ с кодом 403 на бэк, бэк отправляет ответ фронту с кодом 403 и сообщением ошибки, фронт выводит ошибку над формой.
    * фронт отправляет валидный запрос на бэк, бэк отправляет запрост сервису А, сервис А успешно выполняет оплату отправляет ответ с кодом 200 на бэк, бэк вызывает метод сохранения данных об успешной оплате в репозиторий, репозиторий не смог сохранить данные об оплате и возвращает false, выбрасывает исключение OrderException, бэк отправляет на фронт сообщение с кодом 500, фронт выводит сообщение "Во время оплаты возникла ошибка"
    * фронт отправляет валидный запрос на бэк, бэк отправляет запрост сервису А, сервис А успешно выполняет оплату отправляет ответ с кодом 200 на бэк, бэк вызывает метод сохранения данных об успешной оплате в репозиторий, репозиторий успешно сохраняет данные об оплате и возвращает true, бэк отправляет на фронт сообщение с кодом 200, фронт выводит сообщение об успешной оплате.